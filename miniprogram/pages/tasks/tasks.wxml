<view class="tasks-page">
  <!-- çŠ¶æ€ç­›é€‰ -->
  <view class="filter-bar">
    <view
      class="filter-item {{currentStatus === '' ? 'active' : ''}}"
      bindtap="onFilterChange"
      data-status=""
    >å…¨éƒ¨</view>
    <view
      class="filter-item {{currentStatus === 'PENDING' ? 'active' : ''}}"
      bindtap="onFilterChange"
      data-status="PENDING"
    >å¾…å¼€å·¥</view>
    <view
      class="filter-item {{currentStatus === 'IN_PROGRESS' ? 'active' : ''}}"
      bindtap="onFilterChange"
      data-status="IN_PROGRESS"
    >è¿›è¡Œä¸­</view>
    <view
      class="filter-item {{currentStatus === 'COMPLETED' ? 'active' : ''}}"
      bindtap="onFilterChange"
      data-status="COMPLETED"
    >å·²å®Œæˆ</view>
  </view>

  <!-- ä»»åŠ¡åˆ—è¡¨ -->
  <view class="task-list" wx:if="{{!loading && tasks.length > 0}}">
    <view
      class="task-card"
      wx:for="{{tasks}}"
      wx:key="id"
      bindtap="goToDetail"
      data-id="{{item.id}}"
    >
      <view class="task-header">
        <view class="task-no">{{item.workOrderNo}}</view>
        <view class="tag tag-{{item.statusType}}">{{item.statusLabel}}</view>
      </view>

      <view class="task-body">
        <view class="info-row">
          <text class="label">äº§å“:</text>
          <text class="value">{{item.productName}}</text>
        </view>
        <view class="info-row">
          <text class="label">å·¥åº:</text>
          <text class="value">{{item.processName}}</text>
        </view>
        <view class="info-row">
          <text class="label">è¿›åº¦:</text>
          <text class="value">{{item.completedQuantity}} / {{item.planQuantity}}</text>
        </view>
        <view class="info-row" wx:if="{{item.unitPrice}}">
          <text class="label">å•ä»·:</text>
          <text class="value text-success">Â¥{{item.unitPrice}}/ä»¶</text>
        </view>
      </view>

      <view class="task-progress">
        <view class="progress-bar">
          <view class="progress-bar-inner" style="width: {{item.progress}}%"></view>
        </view>
        <text class="progress-text">{{item.progress}}%</text>
      </view>

      <view class="task-footer">
        <text class="time">{{item.createTime}}</text>
        <view class="action-btn" catchtap="goToReport" data-id="{{item.id}}">
          <text wx:if="{{item.status !== 'COMPLETED'}}">å»æŠ¥å·¥</text>
          <text wx:else>æŸ¥çœ‹è¯¦æƒ…</text>
        </view>
      </view>
    </view>
  </view>

  <!-- åŠ è½½ä¸­ -->
  <view class="loading" wx:if="{{loading}}">
    <text>åŠ è½½ä¸­...</text>
  </view>

  <!-- ç©ºçŠ¶æ€ -->
  <view class="empty" wx:if="{{!loading && tasks.length === 0}}">
    <view class="empty-icon">ğŸ“­</view>
    <text class="empty-text">æš‚æ— {{statusLabels[currentStatus] || ''}}ä»»åŠ¡</text>
  </view>

  <!-- åŠ è½½æ›´å¤š -->
  <view class="load-more" wx:if="{{!loading && hasMore}}">
    <text bindtap="loadMore">åŠ è½½æ›´å¤š</text>
  </view>
</view>
